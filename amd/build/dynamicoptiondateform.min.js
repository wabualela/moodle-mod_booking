define("mod_booking/dynamicoptiondateform",["exports","core_form/dynamicform","core_form/modalform","core/templates","core/notification"],(function(_exports,_dynamicform,_modalform,_templates,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * @package    mod_booking
   * @copyright  2022 Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initmodaloptiondateform=_exports.initdynamicoptiondateform=_exports.datelistinit=void 0,_dynamicform=_interopRequireDefault(_dynamicform),_modalform=_interopRequireDefault(_modalform),_templates=_interopRequireDefault(_templates);const optiondateForm=new _dynamicform.default(document.querySelector("#optiondates-form"),"mod_booking\\form\\dynamicoptiondateform");_exports.initdynamicoptiondateform=(cmid,bookingid,optionid,modalTitle,formClass)=>{optiondateForm.load({cmid:cmid,bookingid:bookingid,optionid:optionid,modalTitle:modalTitle,formClass:formClass}).then((()=>{datelistinit(),initmodaloptiondateform(modalTitle,formClass)})).catch((ex=>(0,_notification.exception)(ex))),optiondateForm.addEventListener(optiondateForm.events.SERVER_VALIDATION_ERROR,(()=>{datelistinit(),initmodaloptiondateform(modalTitle,formClass)})),optiondateForm.addEventListener(optiondateForm.events.FORM_SUBMITTED,(e=>{var chooseperiodvalue=document.querySelector('[name="chooseperiod"]').value,reoccurringdatestringvalue=document.querySelector('[name="reoccurringdatestring"]').value;optiondateForm.load({cmid:cmid,bookingid:bookingid,optionid:optionid,modalTitle:modalTitle,formClass:formClass}).then((()=>{e.preventDefault();const response=e.detail;_templates.default.renderForPromise("mod_booking/bookingoption_dates",response).then((_ref=>{let{html:html,js:js}=_ref;_templates.default.replaceNodeContents(".optiondates-list",html,js)})).catch((ex=>(0,_notification.exception)(ex)));for(var oldlists=document.getElementsByClassName("optiondates-list");oldlists.length>1;)oldlists[oldlists.length-1].parentNode.removeChild(oldlists[oldlists.length-1]);datelistinit(),document.querySelector('[name="chooseperiod"]').value=chooseperiodvalue,document.querySelector('[name="reoccurringdatestring"]').value=reoccurringdatestringvalue,document.querySelector("#semesterid").value=chooseperiodvalue,document.querySelector("#dayofweektime").value=reoccurringdatestringvalue,initmodaloptiondateform(modalTitle,formClass)})).catch((ex=>(0,_notification.exception)(ex)))}))};const datelistinit=()=>{var dateform=document.querySelector("#optiondates-form"),datelist=document.querySelector(".optiondates-list");datelist.parentNode.removeChild(datelist),dateform.parentNode.insertBefore(datelist,dateform.nextSibling),datelist.addEventListener("click",(function(e){let action=e.target.dataset.action,targetid=e.target.dataset.targetid;if("delete"===action&&(e.target.closest("li").remove(),document.getElementById(targetid).remove()),"add"===action){let targetElement=e.target.closest("li"),element='<li><span class="badge bg-primary">'+document.querySelector("#meeting-time").value+'</span> <i class="fa fa-trash ml-2 icon-red" data-action="delete"></i></li>';targetElement.insertAdjacentHTML("afterend",element)}})),document.querySelector('[name="chooseperiod"]').addEventListener("change",(e=>{document.querySelector("#semesterid").value=e.target.value})),waitForElm('input[name="reoccurringdatestring"]').then((stringelm=>{const submitbutton=document.querySelector('#optiondates-form input[name="submitbutton"]');stringelm.value.trim().toLowerCase().includes("block")?submitbutton.style.display="none":submitbutton.style.display="block"}));document.querySelector('input[name="reoccurringdatestring"]').addEventListener("keyup",(e=>{const submitbutton=document.querySelector('#optiondates-form input[name="submitbutton"]');e.target.value.trim().toLowerCase().includes("block")?submitbutton.style.display="none":submitbutton.style.display="block",document.querySelector("#dayofweektime").value=e.target.value}))};_exports.datelistinit=datelistinit;const initmodaloptiondateform=(modalTitle,formClass)=>{waitForElm('button[name="customdatesbtn"]').then((customdatesbtn=>{customdatesbtn.addEventListener("click",(e=>{e.preventDefault();const modalform=new _modalform.default({formClass:formClass,modalConfig:{title:modalTitle},returnFocus:e.currentTarget});modalform.addEventListener(modalform.events.FORM_SUBMITTED,(e=>{const response=e.detail;_templates.default.renderForPromise("mod_booking/bookingoption_dates_custom_list_items",response).then((_ref2=>{let{html:html,js:js}=_ref2;_templates.default.appendNodeContents("ul.reoccurringdates",html,js)})).catch((ex=>(0,_notification.exception)(ex)));_templates.default.renderForPromise("mod_booking/bookingoption_dates_custom_hidden_inputs",response).then((_ref3=>{let{html:html,js:js}=_ref3;_templates.default.appendNodeContents("div.optiondates-list",html,js)})).catch((ex=>(0,_notification.exception)(ex)))})),modalform.show()}))}))};function waitForElm(selector){return new Promise((resolve=>{if(document.querySelector(selector))return resolve(document.querySelector(selector));const observer=new MutationObserver((()=>{document.querySelector(selector)&&(resolve(document.querySelector(selector)),observer.disconnect())}));observer.observe(document.body,{childList:!0,subtree:!0})}))}_exports.initmodaloptiondateform=initmodaloptiondateform}));

//# sourceMappingURL=dynamicoptiondateform.min.js.map